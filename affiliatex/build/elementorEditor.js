var affiliatexExports;(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.ReactDOM;var i=e.n(a);const n=window.affiliatexExports.blockComponents,l=window.wp.i18n,o=window.wp.data,r=window.ReactJSXRuntime,s=()=>{const e=(0,o.useSelect)(e=>"upgrade-modal"===e("affiliatex").getActiveModal()),{setActiveModal:t}=(0,o.useDispatch)("affiliatex"),{modalType:a,isInserterOpen:i,blockTitle:s,demoSlug:d,modalTitle:c}=(0,o.useSelect)(e=>e("affiliatex").getUpgradeModal()),f=()=>{m(),t("")},m=()=>{"block"===a&&i&&(0,o.dispatch)("core/editor").setIsInserterOpened(!0)};return e&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"affx-upgrade-modal",onClick:f,children:(0,r.jsxs)("div",{className:"affx-upgrade-modal_inner",onClick:e=>{e.stopPropagation(),m()},children:[(0,r.jsxs)("div",{className:"affx-upgrade-modal_heading",children:[(0,r.jsx)("h3",{children:"amazon"===a?c:(0,r.jsxs)(r.Fragment,{children:[(0,l.__)("Enhance with","affiliatex"),(0,r.jsx)("span",{children:" "+(0,l.__)("Pro","affiliatex")+" "}),(0,l.__)("Blocks","affiliatex")]})}),(0,r.jsx)("div",{className:"btn_close",onClick:f,children:(0,r.jsx)(n.CloseIcon,{})})]}),(0,r.jsxs)("div",{className:"affx-upgrade-modal_body",children:[(0,r.jsxs)("div",{className:"affx-upgrade-modal_body_left",children:[s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:"block"===a?(0,l.sprintf)((0,l.__)("%s is one of our Pro blocks.","affiliatex"),s):(0,r.jsxs)(r.Fragment,{children:[(0,l.sprintf)((0,l.__)("%s is a","affiliatex"),s)," ",(0,r.jsx)("b",{children:(0,l.__)("premium","affiliatex")}),(0,l.__)("feature.","affiliatex")]})}),(0,r.jsxs)("p",{children:[(0,l.__)("If you want to use it please kindly consider","affiliatex")," ",(0,r.jsx)("a",{href:"https://affiliatexblocks.com/pricing/?utm_source=plugin&utm_medium=editor&utm_campaign=pro_upgrade",target:"_blank",rel:"noreferrer",children:(0,l.__)("upgrading to pro","affiliatex")})," ",(0,l.__)("and unlock more exciting blocks and features.","affiliatex")]})]}),(0,r.jsxs)("div",{className:"affx-upgrade-modal_button_group",children:[d&&"block"===a&&(0,r.jsx)("a",{href:(0,l.sprintf)("https://affiliatexblocks.com/%s?utm_source=plugin&utm_medium=editor&utm_campaign=pro_block_demo_%s",d,d.replace(/-/g,"_")),target:"_blank",className:"affx-upgrade-modal_button affx-upgrade-modal_button_primary",rel:"noreferrer",children:(0,l.__)("View Demo","affiliatex")}),"amazon"===a&&(0,r.jsx)("a",{href:"https://affiliatexblocks.com/amazon-api-integration/?utm_source=plugin&utm_medium=editor&utm_campaign=amazon_popup",target:"_blank",className:"affx-upgrade-modal_button affx-upgrade-modal_button_primary",rel:"noreferrer",children:(0,l.__)("View Details","affiliatex")}),(0,r.jsx)("a",{href:"https://affiliatexblocks.com/pricing/?utm_source=plugin&utm_medium=editor&utm_campaign=pro_upgrade",target:"_blank",className:"affx-upgrade-modal_button affx-upgrade-modal_button_secondary",rel:"noreferrer",children:(0,l.__)("Upgrade Now","affiliatex")})]})]}),(0,r.jsx)("div",{className:"affx-upgrade-modal_body_right",children:(0,r.jsx)(n.ModalRocketIcon,{})})]})]})})})},d=window.wp.components,c=({fill:e="#0034ff"})=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"affx-lock-icon",width:"10",height:"10",viewBox:"0 0 26 26",children:(0,r.jsx)("g",{fill:e,fillRule:"nonzero",children:(0,r.jsx)("path",{d:"M16,0c-2.21094,0 -4.12109,0.91797 -5.3125,2.40625c-1.19141,1.48828 -1.6875,3.41797 -1.6875,5.5v1.09375h3v-1.09375c0,-1.57812 0.39063,-2.82031 1.03125,-3.625c0.64063,-0.80469 1.51172,-1.28125 2.96875,-1.28125c1.46094,0 2.32813,0.44922 2.96875,1.25c0.64063,0.80078 1.03125,2.05859 1.03125,3.65625v1.09375h3v-1.09375c0,-2.09375 -0.52734,-4.04297 -1.71875,-5.53125c-1.19141,-1.48828 -3.07422,-2.375 -5.28125,-2.375zM9,10c-1.65625,0 -3,1.34375 -3,3v10c0,1.65625 1.34375,3 3,3h14c1.65625,0 3,-1.34375 3,-3v-10c0,-1.65625 -1.34375,-3 -3,-3zM16,15c1.10547,0 2,0.89453 2,2c0,0.73828 -0.40234,1.37109 -1,1.71875v2.28125c0,0.55078 -0.44922,1 -1,1c-0.55078,0 -1,-0.44922 -1,-1v-2.28125c-0.59766,-0.34766 -1,-0.98047 -1,-1.71875c0,-1.10547 0.89453,-2 2,-2z"})})}),f=({isOpen:e,onClose:a,widgets:i,selectedWidget:n,onWidgetSelect:o,ajaxAction:s,ajaxNonce:f,onInsertTemplate:m,onReplaceTemplate:p,canReplace:u=!1,editorType:x="gutenberg"})=>{const[g,w]=(0,t.useState)({}),[h,_]=(0,t.useState)(!1),[b,v]=(0,t.useState)(2),y=window.AffiliateX&&"true"===window.AffiliateX.proActive,j=n?g[n]||[]:Object.values(g).flat();(0,t.useEffect)(()=>{const e=()=>{const e=window.innerWidth;v(e<=1200?1:2)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const k=(0,t.useCallback)(async()=>{_(!0);try{const e=await jQuery.ajax({url:ajaxurl,method:"POST",data:{action:s,nonce:f}});e.success&&w(e.data)}catch(e){console.error("Failed to fetch templates:",e)}finally{_(!1)}},[s,f]);(0,t.useEffect)(()=>{e&&0===Object.keys(g).length&&k()},[e,g,k]);const A=()=>{window.wp&&window.wp.data&&(window.wp.data.dispatch("affiliatex").setActiveModal("upgrade-modal"),window.wp.data.dispatch("affiliatex").setUpgradeModal({blockTitle:(0,l.__)("This template","affiliatex")}))},T=e=>{const t="elementor"===x?"affiliatex-":"affiliatex/";return e?.replace(new RegExp(`^${t}`),"")},C=({template:e,index:i,columnIndex:n})=>{const[o,s]=(0,t.useState)(!1),d=u&&"function"==typeof u?u(e):u;return(0,r.jsxs)("div",{className:`affx-template-item ${!y&&e.isPro?"affx-template-item--locked":""} ${o?"":"affx-template-item--loading"}`,onClick:!y&&e.isPro?()=>A():null,onKeyDown:!y&&e.isPro?e=>{"Enter"!==e.key&&" "!==e.key||A()}:null,role:!y&&e.isPro?"button":void 0,tabIndex:!y&&e.isPro?0:void 0,children:[!o&&"gutenberg"===x&&(0,r.jsxs)("div",{className:"affx-template-skeleton",children:[(0,r.jsx)("div",{className:"affx-template-skeleton__image"}),(0,r.jsx)("span",{className:"affx-loader"})]}),(0,r.jsx)("img",{src:e.preview,alt:(0,l.__)("Template preview","affiliatex"),className:"template-preview-image",style:{display:o?"block":"none"},onLoad:()=>s(!0)}),!y&&e.isPro?(0,r.jsxs)("div",{className:"affx-template-item__lock",children:[(0,r.jsx)(c,{fill:"#fff"}),(0,r.jsx)("span",{children:(0,l.__)("Available in AffiliateX Pro","affiliatex")})]}):(o||"elementor"===x)&&(0,r.jsxs)("div",{className:"affx-template-item__info",children:[(0,r.jsx)("button",{className:"affx-button-primary",onClick:()=>(e=>{m(e),a()})(e),title:(0,l.__)("Add Template","affiliatex"),children:(0,l.__)("Add","affiliatex")}),d&&(0,r.jsx)("button",{className:"affx-button-primary",onClick:()=>(e=>{p(e),a()})(e),title:(0,l.__)("Replace Template","affiliatex"),children:(0,l.__)("Replace","affiliatex")})]})]},`template-${i}-col${n}`)},N=e=>j.filter((t,a)=>a%b===e);if(!e)return null;const E="elementor"===x?(0,l.__)("All Widgets","affiliatex"):(0,l.__)("All Blocks","affiliatex");return(0,r.jsx)(d.Modal,{title:(0,l.__)("Template Library","affiliatex"),onRequestClose:a,className:"affx-template-library-modal",children:(0,r.jsxs)("div",{className:"affx-template-library-modal__content",children:[(0,r.jsx)("div",{className:"affx-template-library-modal__sidebar",children:(0,r.jsxs)("div",{className:"affx-blocks-list",children:[(0,r.jsx)("div",{className:"affx-block-item "+(n?"":"active"),onClick:()=>o(""),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||o("")},role:"button",tabIndex:0,children:(0,r.jsx)("span",{children:E})}),i.map(e=>{return(0,r.jsxs)("div",{className:"affx-block-item "+(n===T(e.name)?"active":""),onClick:()=>o(T(e.name)),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||o(T(e.name))},role:"button",tabIndex:0,children:[(0,r.jsx)("span",{children:(t=e.title,t?.replace(/^AffiliateX\s+/i,""))}),e.isPro&&(0,r.jsx)("div",{className:"affx-pro-badge",children:(0,l.__)("Pro","affiliatex")})]},e.name);var t})]})}),(0,r.jsxs)("div",{className:"affx-template-library-modal__main",children:[h&&(0,r.jsx)("span",{className:"affx-loader"}),!h&&j.length>0&&(0,r.jsx)("div",{className:"affx-templates-grid",children:[...Array(b)].map((e,t)=>(0,r.jsx)("div",{className:"grid-column",children:N(t).map((e,a)=>(0,r.jsx)(C,{template:e,index:a,columnIndex:t},`template-${a}-col${t}`))},`column-${t}`))}),!h&&0===j.length&&(0,r.jsx)("p",{className:"affx-template-library-modal__no-templates",children:(0,l.__)("No templates found","affiliatex")})]})]})})},m=()=>{const[e,a]=(0,t.useState)(!1),[i,n]=(0,t.useState)(""),[l,o]=(0,t.useState)(null),[s,d]=(0,t.useState)(null),[c,m]=(0,t.useState)([]),p=window.AffiliateX&&"true"===window.AffiliateX.proActive;(0,t.useEffect)(()=>{let e=(()=>{if(!window.elementor||!window.elementor.widgetsCache)return[];const e=[];for(const[t,a]of Object.entries(window.elementor.widgetsCache))t.startsWith("affiliatex-")&&e.push({name:t,title:a.title||t,icon:a.icon||"eicon-plug"});return e})();if(!p&&window.proBlocks){const t=window.proBlocks.map(e=>({name:e.name.replace("affiliatex/","affiliatex-"),title:e.title,icon:"eicon-plug",isPro:!0}));e=[...e,...t]}m(e)},[p]),(0,t.useEffect)(()=>{window.AffiliateXElementorTemplateLibrary={open:(e,t)=>{e&&(n(e),t&&d(e)),t&&o(t),a(!0)},close:()=>{a(!1),o(null),d(null)}}},[]);const u=e=>{if(!e||!e.view)return;const t=()=>{e.view.$el&&e.view.$el[0]?(e.view.$el[0].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{e.view.model.trigger("request:edit")},100)):requestAnimationFrame(t)};requestAnimationFrame(t)};return(0,r.jsx)(f,{isOpen:e,onClose:()=>{a(!1),o(null),d(null)},widgets:c,selectedWidget:i,onWidgetSelect:n,ajaxAction:"get_elementor_template_library",ajaxNonce:window.AffiliateX?.ajax_nonce||"",onInsertTemplate:e=>{(e=>{if(!window.elementor||!window.$e)return;const t={elType:"section",elements:[{elType:"column",elements:[e]}]},a=elementor.documents.getCurrent().container,i=a.children.length;$e.run("document/elements/create",{model:t,container:a,options:{at:i}});const n=()=>{const e=a.children[i],t=e?.children?.[0],l=t?.children?.[0];l?u(l):requestAnimationFrame(n)};requestAnimationFrame(n)})({id:Math.random().toString(36).substr(2,8),elType:"widget",widgetType:`affiliatex-${i||"single-product"}`,settings:e.settings||{},elements:e.elements||[]})},onReplaceTemplate:e=>{if(!l)return;const t=l.get("id"),a=elementor.getContainer(t);if(!a)return;const i=l.get("widgetType"),n=a.parent,r=a.view._index,s={elType:"widget",widgetType:i,settings:e.settings||{}};$e.run("document/elements/delete",{container:a}),$e.run("document/elements/create",{container:n,model:s,options:{at:r}});const c=()=>{const e=n.children[r];e?u(e):requestAnimationFrame(c)};requestAnimationFrame(c),o(null),d(null)},canReplace:l&&s&&i===s,editorType:"elementor"})};(e=>{const t={activeWidgetModel:null,lastCacheKey:null,debounceTimer:null,init(){window.AffiliateX&&"true"!==window.AffiliateX.proActive&&t.initUpgradeModal(),t.bindEvents(),t.initTemplateLibrary()},bindEvents(){window.AffiliateX&&"true"!==window.AffiliateX.proActive&&(e(document).on("click",".affx-action-button__amazon",t.triggerUpgradeModal),e(document).on("click",".affx-connect-all-wrapper",t.triggerUpgradeModal)),e(window).on("elementor:init",t.addConnectAllButton),e(window).on("elementor:init",t.addTemplateLibraryButton),e(window).on("elementor:init",t.initElementorHooks),e(document).on("click",".affx-template-library-button",t.openTemplateLibrary),e(document).on("error",function(e){if(e.originalEvent?.filename?.includes("wp-auth-check.js"))return!1})},initElementorHooks(){elementor&&elementor.hooks&&(elementor.hooks.addAction("panel/open_editor/widget",t.handleActiveWidget),elementor.channels.editor.on("section:activated",t.handleSectionActivated),e(document).on("change",t.debouncedHandleDisabledControls))},handleActiveWidget(e,a){a?.get("widgetType")?.includes("affiliatex")?t.activeWidgetModel=a:(t.activeWidgetModel=null,t.lastCacheKey=null)},handleSectionActivated(){t.lastCacheKey=null,t.handleDisabledControls()},debouncedHandleDisabledControls(){clearTimeout(t.debounceTimer),t.debounceTimer=setTimeout(()=>{t.handleDisabledControls()},150)},handleDisabledControls(){if(!t.activeWidgetModel)return;const a=t.activeWidgetModel.getSetting("productContentListAmazon")||"",i=`${t.activeWidgetModel.id}_${a}`;if(i===t.lastCacheKey)return;t.lastCacheKey=i;const n=a.match(/limit="(\d+),(\d+)"/);let l=!1;if(n){const e=parseInt(n[1],10),t=parseInt(n[2],10);l=e>0||t>0}["descriptionLength","listItemCount"].map(t=>({name:t,element:e(`#elementor-panel [data-setting="${t}"]`)})).filter(e=>e.element.length).forEach(({element:e})=>{const t=e.closest(".elementor-control");l?(t.addClass("affx-amazon-connected"),e.prop("disabled",!0)):(t.removeClass("affx-amazon-connected"),e.prop("disabled",!1))})},initUpgradeModal(){e("body").append('<div id="affx-upgrade-modal-root"></div>');const t=document.getElementById("affx-upgrade-modal-root");t&&!t.hasChildNodes()&&i().createRoot(t).render((0,r.jsx)(s,{}))},initTemplateLibrary(){e(window).on("elementor:init",()=>{setTimeout(()=>{(()=>{let e=document.getElementById("affx-elementor-template-library-root");e||(e=document.createElement("div"),e.id="affx-elementor-template-library-root",document.body.appendChild(e)),i().createRoot(e).render((0,r.jsx)(m,{}))})()},1e3)})},openTemplateLibrary(e){e.preventDefault();let t=null,a=null;try{const e=elementor?.getPanelView()?.getCurrentPageView(),i=e?.model;i&&i.get("widgetType")&&(t=i.get("widgetType").replace("affiliatex-",""),a=i)}catch(e){console.error("Error getting widget type:",e)}window.AffiliateXElementorTemplateLibrary?window.AffiliateXElementorTemplateLibrary.open(t,a):console.error("Template library not initialized")},triggerUpgradeModal(){window.wp.data.dispatch("affiliatex").setActiveModal("upgrade-modal"),window.wp.data.dispatch("affiliatex").setUpgradeModal({modalType:"amazon",modalTitle:(0,l.__)("Amazon Integration","affiliatex"),blockTitle:(0,l.__)("Amazon Integration","affiliatex")})},addConnectAllButton(){const t=["affiliatex-product-comparison","affiliatex-product-table","affiliatex-pros-and-cons","affiliatex-specifications","affiliatex-verdict","affiliatex-versus-line","affiliatex-versus","affiliatex-dynamic-listing"],a=["affiliatex-top-products","affiliatex-coupon-listing","affiliatex-coupon-grid"],i=(i,n)=>{if(i&&n&&n?.get("widgetType")&&n.get("widgetType").includes("affiliatex")&&!t.includes(n.get("widgetType"))&&"content"===i.getOption("tab")){const t=e(i.el).find(".elementor-panel-navigation");0===e(i.el).find(".affx-connect-all-wrapper").length&&(t.after(AffiliateX.connectAllButton),a.includes(n.get("widgetType"))&&e(i.el).find(".affx-connect-all-wrapper").hide())}};elementor.hooks.addAction("panel/open_editor/widget",i);const n=new WeakSet;elementor.hooks.addFilter("controls/base/behaviors",e=>{const t=elementor.getPanelView().getCurrentPageView();return t&&!n.has(t)&&(n.add(t),i(t,t.model)),e})},addTemplateLibraryButton(){if(window.AffiliateX&&"true"!==window.AffiliateX.hasElementorTemplates)return;const t=["affiliatex-buttons","affiliatex-cta","affiliatex-notice","affiliatex-product-comparison","affiliatex-product-table","affiliatex-pros-and-cons","affiliatex-single-product","affiliatex-single-coupon","affiliatex-specifications","affiliatex-verdict","affiliatex-versus-line","affiliatex-top-products","affiliatex-versus","affiliatex-rating-box","affiliatex-single-product-pros-and-cons","affiliatex-product-image-button","affiliatex-coupon-grid","affiliatex-coupon-listing","affiliatex-product-tabs","affiliatex-dynamic-listing"],a=(a,i)=>{if(a&&i&&i?.get("widgetType")&&t.includes(i.get("widgetType"))&&"content"===a.getOption("tab")){const t=e(a.el).find(".elementor-panel-navigation");0===e(a.el).find(".affx-template-library-button-wrapper").length&&t.after(AffiliateX.templateLibraryButton)}};elementor.hooks.addAction("panel/open_editor/widget",a);const i=new WeakSet;elementor.hooks.addFilter("controls/base/behaviors",e=>{const t=elementor.getPanelView().getCurrentPageView();return t&&!i.has(t)&&(i.add(t),a(t,t.model)),e})}};t.init()})(jQuery),(affiliatexExports=void 0===affiliatexExports?{}:affiliatexExports).elementorEditor={}})();